This code is really old.  I wrote it in grad school.

Please do not judge me for its quality.
